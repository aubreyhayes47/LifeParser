<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Life Parser - Text-Based Life Sim</title>
    <style>
        :root {
            --color-background: #1a1a1a;
            --color-surface: #252525;
            --color-text: #e0e0e0;
            --color-text-secondary: #a0a0a0;
            --color-primary: #4a9eff;
            --color-success: #4ade80;
            --color-warning: #fbbf24;
            --color-error: #f87171;
            --color-border: #3a3a3a;
            --font-mono: 'Courier New', monospace;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-mono);
            background: var(--color-background);
            color: var(--color-text);
            line-height: 1.6;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        #game-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }

        #status-bar {
            background: var(--color-surface);
            border-bottom: 2px solid var(--color-border);
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 16px;
            font-size: 14px;
        }

        .stat-group {
            display: flex;
            gap: 20px;
        }

        .stat {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .stat-label {
            color: var(--color-text-secondary);
        }

        .stat-value {
            color: var(--color-primary);
            font-weight: bold;
        }

        .stat-value.warning { color: var(--color-warning); }
        .stat-value.error { color: var(--color-error); }
        .stat-value.success { color: var(--color-success); }

        #output-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: var(--color-background);
        }

        .output-text {
            margin-bottom: 16px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .output-text.location {
            color: var(--color-primary);
            font-weight: bold;
            font-size: 16px;
            margin-top: 24px;
            margin-bottom: 12px;
        }

        .output-text.description {
            color: var(--color-text);
            line-height: 1.8;
        }

        .output-text.event {
            background: var(--color-surface);
            border-left: 4px solid var(--color-warning);
            padding: 16px;
            margin: 20px 0;
        }

        .output-text.success {
            color: var(--color-success);
        }

        .output-text.error {
            color: var(--color-error);
        }

        .output-text.system {
            color: var(--color-text-secondary);
            font-style: italic;
        }

        .choice-box {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            padding: 16px;
            margin: 16px 0;
            border-radius: 4px;
        }

        .choice-option {
            padding: 8px 12px;
            margin: 8px 0;
            background: rgba(74, 158, 255, 0.1);
            border-left: 3px solid var(--color-primary);
            cursor: pointer;
            transition: all 0.2s;
        }

        .choice-option:hover {
            background: rgba(74, 158, 255, 0.2);
            transform: translateX(4px);
        }

        #input-container {
            background: var(--color-surface);
            border-top: 2px solid var(--color-border);
            padding: 16px 20px;
            display: flex;
            gap: 12px;
            align-items: center;
        }

        #command-input {
            flex: 1;
            background: var(--color-background);
            border: 2px solid var(--color-border);
            color: var(--color-text);
            padding: 12px 16px;
            font-family: var(--font-mono);
            font-size: 14px;
            border-radius: 4px;
            outline: none;
        }

        #command-input:focus {
            border-color: var(--color-primary);
        }

        #submit-btn {
            background: var(--color-primary);
            color: var(--color-background);
            border: none;
            padding: 12px 24px;
            font-family: var(--font-mono);
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.2s;
        }

        #submit-btn:hover {
            background: #3a8eef;
            transform: translateY(-1px);
        }

        #submit-btn:active {
            transform: translateY(0);
        }

        .command-prompt {
            color: var(--color-primary);
            margin-right: 8px;
        }

        .help-text {
            color: var(--color-text-secondary);
            font-size: 12px;
            margin-top: 8px;
        }

        .divider {
            border-top: 1px solid var(--color-border);
            margin: 20px 0;
        }

        #output-container::-webkit-scrollbar {
            width: 10px;
        }

        #output-container::-webkit-scrollbar-track {
            background: var(--color-background);
        }

        #output-container::-webkit-scrollbar-thumb {
            background: var(--color-border);
            border-radius: 5px;
        }

        #output-container::-webkit-scrollbar-thumb:hover {
            background: #4a4a4a;
        }

        @media (max-width: 768px) {
            #status-bar {
                font-size: 12px;
            }

            .stat-group {
                gap: 12px;
            }

            #output-container {
                padding: 16px;
            }

            #input-container {
                padding: 12px 16px;
            }
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="status-bar">
            <div class="stat-group">
                <div class="stat">
                    <span class="stat-label">Day:</span>
                    <span class="stat-value" id="day">1</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Time:</span>
                    <span class="stat-value" id="time">8:00 AM</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Money:</span>
                    <span class="stat-value success" id="money">$500</span>
                </div>
            </div>
            <div class="stat-group">
                <div class="stat">
                    <span class="stat-label">Health:</span>
                    <span class="stat-value" id="health">100</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Energy:</span>
                    <span class="stat-value" id="energy">100</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Hunger:</span>
                    <span class="stat-value" id="hunger">30</span>
                </div>
            </div>
        </div>

        <div id="output-container"></div>

        <div id="input-container">
            <span class="command-prompt">&gt;</span>
            <input type="text" id="command-input" placeholder="Type a command (e.g., 'look around', 'go to cafe', 'check stats')" autocomplete="off">
            <button id="submit-btn">ENTER</button>
        </div>
    </div>

    <script>
        // ============================================
        // GAME STATE
        // ============================================
        const gameState = {
            character: {
                name: "You",
                day: 1,
                hour: 8,
                minute: 0,
                money: 500,
                health: 100,
                energy: 100,
                hunger: 30,
                intelligence: 50,
                charisma: 50,
                strength: 40,
                businessSkill: 30
            },
            currentLocation: 'home',
            businesses: [],
            relationships: {},
            inventory: ['phone', 'wallet', 'keys'],
            flags: {
                hasJob: false,
                metInvestor: false,
                ownsCafe: false
            },
            commandHistory: [],
            lastNPC: null,
            pendingEvent: null
        };

        // ============================================
        // WORLD DATA
        // ============================================
        const locations = {
            home: {
                name: "Your Apartment",
                description: "A small studio apartment. It's modest but clean. Your bed sits in the corner, and a small kitchenette lines one wall. Sunlight streams through a single window overlooking the street.",
                exits: ['street'],
                actions: ['sleep', 'eat', 'use laptop'],
                npcs: []
            },
            street: {
                name: "Main Street",
                description: "The heart of downtown. Cars pass by occasionally. You can see the gym to the north, a small café to the east, the bank to the south, and your apartment building to the west.",
                exits: ['gym', 'cafe', 'bank', 'home'],
                actions: ['look around'],
                npcs: []
            },
            gym: {
                name: "24/7 Fitness Gym",
                description: "A well-equipped gym with free weights, machines, and cardio equipment. The smell of rubber and determination fills the air. Motivational posters line the walls.",
                exits: ['street'],
                actions: ['workout', 'talk to trainer'],
                npcs: ['trainer']
            },
            cafe: {
                name: "Coffee Bean Café",
                description: "A cozy café with wooden tables and the rich aroma of fresh coffee. A few customers sit working on laptops. The barista is wiping down the counter.",
                exits: ['street'],
                actions: ['order coffee', 'talk to owner', 'apply for job'],
                npcs: ['owner', 'barista']
            },
            bank: {
                name: "First National Bank",
                description: "A modern bank with polished floors and professional atmosphere. Tellers work behind glass windows. You see a loan officer at a desk in the corner.",
                exits: ['street'],
                actions: ['check balance', 'take loan', 'talk to loan officer'],
                npcs: ['loan officer']
            }
        };

        // ============================================
        // NLP PARSER
        // ============================================
        class NLPParser {
            constructor() {
                this.verbs = {
                    movement: ['go', 'walk', 'move', 'travel', 'head', 'run', 'enter', 'leave', 'exit'],
                    interaction: ['talk', 'speak', 'chat', 'ask', 'tell', 'discuss', 'greet'],
                    business: ['buy', 'purchase', 'sell', 'invest', 'hire', 'fire', 'manage', 'open'],
                    action: ['work', 'train', 'study', 'eat', 'sleep', 'exercise', 'workout', 'drink'],
                    examination: ['look', 'examine', 'inspect', 'check', 'read', 'view', 'show'],
                    inventory: ['take', 'grab', 'get', 'drop', 'use', 'give', 'order']
                };

                this.patterns = [
                    { regex: /^(go to|goto|enter|visit)\s+(the\s+)?(.*)/i, action: 'move', target: 3 },
                    { regex: /^go\s+(north|south|east|west)/i, action: 'move', direction: 1 },
                    { regex: /^talk to\s+(the\s+)?(.*?)(\s+about\s+(.*))?$/i, action: 'talk', target: 2, topic: 4 },
                    { regex: /^(check|view|show)\s+(my\s+)?(.*)/i, action: 'examine', target: 3 },
                    { regex: /^(look|look around)/i, action: 'look', target: 'room' },
                    { regex: /^(work|workout|exercise)/i, action: 'work', target: 'current' },
                    { regex: /^(sleep|rest|nap)/i, action: 'sleep', duration: 8 },
                    { regex: /^(eat|drink)\s*(.*)/i, action: 'eat', target: 2 },
                    { regex: /^(take|get|request)\s+(a\s+)?loan(\s+for\s+)?(\d+)?/i, action: 'loan', amount: 4 },
                    { regex: /^apply for job/i, action: 'apply', target: 'job' },
                    { regex: /^(buy|purchase|open)\s+(a\s+)?(.*)/i, action: 'buy', target: 3 },
                    { regex: /^(help|commands|\?)/i, action: 'help' },
                    { regex: /^(inventory|inv|items)/i, action: 'inventory' },
                    { regex: /^stats/i, action: 'stats' },
                    { regex: /^save/i, action: 'save' },
                    { regex: /^load/i, action: 'load' }
                ];
            }

            parse(input) {
                input = input.trim().toLowerCase();

                for (let pattern of this.patterns) {
                    const match = input.match(pattern.regex);
                    if (match) {
                        const command = { action: pattern.action };
                        
                        if (pattern.target) {
                            command.target = match[pattern.target] || null;
                        }
                        if (pattern.topic && match[pattern.topic]) {
                            command.topic = match[pattern.topic];
                        }
                        if (pattern.direction) {
                            command.direction = match[pattern.direction];
                        }
                        if (pattern.amount && match[pattern.amount]) {
                            command.amount = parseInt(match[pattern.amount]);
                        }
                        if (pattern.duration) {
                            command.duration = pattern.duration;
                        }

                        return command;
                    }
                }

                return { action: 'unknown', input: input };
            }

            findClosestLocation(input) {
                const locations_list = Object.keys(locations);
                for (let loc of locations_list) {
                    if (input.includes(loc) || loc.includes(input)) {
                        return loc;
                    }
                }
                return null;
            }
        }

        // ============================================
        // GAME ENGINE
        // ============================================
        class GameEngine {
            constructor() {
                this.parser = new NLPParser();
                this.outputElement = document.getElementById('output-container');
                this.inputElement = document.getElementById('command-input');
            }

            init() {
                this.displayWelcome();
                this.updateUI();
            }

            displayWelcome() {
                this.output("═══════════════════════════════════════════════════", "system");
                this.output("LIFE PARSER", "location");
                this.output("A Text-Based Life Simulation Game", "system");
                this.output("═══════════════════════════════════════════════════", "system");
                this.output("");
                this.output("You wake up in your small apartment on Day 1. You have $500 to your name and dreams of building a business empire. Every decision matters. Every day counts.", "description");
                this.output("");
                this.output("Type 'help' for a list of commands, or try natural language like:", "system");
                this.output("  • 'look around' - Examine your surroundings", "system");
                this.output("  • 'go to cafe' - Travel to locations", "system");
                this.output("  • 'check stats' - View your character", "system");
                this.output("  • 'talk to [person]' - Interact with NPCs", "system");
                this.output("");
                this.describeLocation();
            }

            processCommand(input) {
                if (!input.trim()) return;

                gameState.commandHistory.push(input);
                this.output(`> ${input}`, "system");
                this.output("");

                const command = this.parser.parse(input);

                switch(command.action) {
                    case 'move':
                        this.handleMovement(command);
                        break;
                    case 'look':
                        this.describeLocation();
                        break;
                    case 'talk':
                        this.handleConversation(command);
                        break;
                    case 'examine':
                        this.handleExamine(command);
                        break;
                    case 'work':
                        this.handleWork();
                        break;
                    case 'sleep':
                        this.handleSleep(command.duration);
                        break;
                    case 'eat':
                        this.handleEat(command);
                        break;
                    case 'loan':
                        this.handleLoan(command);
                        break;
                    case 'apply':
                        this.handleApply();
                        break;
                    case 'buy':
                        this.handleBuy(command);
                        break;
                    case 'help':
                        this.showHelp();
                        break;
                    case 'inventory':
                        this.showInventory();
                        break;
                    case 'stats':
                        this.showStats();
                        break;
                    case 'save':
                        this.saveGame();
                        break;
                    case 'load':
                        this.loadGame();
                        break;
                    case 'unknown':
                        this.output(`I don't understand "${input}". Try 'help' for available commands.`, "error");
                        break;
                }

                this.updateUI();
                this.checkRandomEvents();
            }

            handleMovement(command) {
                let targetLocation = null;

                if (command.target) {
                    targetLocation = this.parser.findClosestLocation(command.target);
                }

                const currentLoc = locations[gameState.currentLocation];

                if (!targetLocation || !locations[targetLocation]) {
                    this.output("You can't go there from here.", "error");
                    this.output(`Available exits: ${currentLoc.exits.join(', ')}`, "system");
                    return;
                }

                if (!currentLoc.exits.includes(targetLocation)) {
                    this.output(`You can't reach ${locations[targetLocation].name} from here.`, "error");
                    this.output(`Available exits: ${currentLoc.exits.join(', ')}`, "system");
                    return;
                }

                gameState.currentLocation = targetLocation;
                this.advanceTime(15);
                this.modifyEnergy(-5);

                this.output(`You travel to ${locations[targetLocation].name}.`, "success");
                this.output("");
                this.describeLocation();
            }

            describeLocation() {
                const loc = locations[gameState.currentLocation];
                this.output(loc.name.toUpperCase(), "location");
                this.output(loc.description, "description");
                this.output("");

                if (loc.npcs.length > 0) {
                    this.output(`People here: ${loc.npcs.join(', ')}`, "system");
                }

                this.output(`Exits: ${loc.exits.join(', ')}`, "system");
                this.output(`Actions: ${loc.actions.join(', ')}`, "system");
            }

            handleConversation(command) {
                const loc = locations[gameState.currentLocation];
                const target = command.target;

                if (!target) {
                    this.output("Talk to whom?", "error");
                    return;
                }

                if (!loc.npcs.some(npc => npc.includes(target) || target.includes(npc))) {
                    this.output(`There's no one like that here.`, "error");
                    return;
                }

                gameState.lastNPC = target;

                if (target.includes('owner') && gameState.currentLocation === 'cafe') {
                    this.output('You approach the café owner, a friendly middle-aged woman.', "description");
                    this.output('"Welcome! Looking for a job or interested in buying the place?"', "description");
                    this.output('She laughs. "Just kidding about buying it... unless you have $50,000?"', "description");
                } else if (target.includes('trainer')) {
                    this.output('The muscular trainer nods at you.', "description");
                    this.output('"Want to build some muscle? A good workout session costs $20."', "description");
                } else if (target.includes('loan officer')) {
                    this.output('The loan officer adjusts his glasses and smiles professionally.', "description");
                    this.output('"We offer business loans from $5,000 to $50,000 at 8% interest. What do you need?"', "description");
                } else {
                    this.output(`You chat with the ${target}. They seem friendly.`, "description");
                }

                this.advanceTime(10);
            }

            handleExamine(command) {
                const target = command.target;

                if (target.includes('stat') || target.includes('character')) {
                    this.showStats();
                } else if (target.includes('money') || target.includes('balance') || target.includes('cash')) {
                    this.output(`You have $${gameState.character.money}.`, "description");
                } else if (target.includes('health')) {
                    this.output(`Your health is ${gameState.character.health}/100.`, "description");
                } else if (target.includes('time')) {
                    this.output(`It's Day ${gameState.character.day}, ${this.formatTime()}.`, "description");
                } else if (target.includes('business') || target.includes('cafe')) {
                    if (gameState.flags.ownsCafe) {
                        this.output('You own the Coffee Bean Café!', "success");
                        this.output('Revenue: $200/day (currently passive)', "description");
                    } else {
                        this.output("You don't own any businesses yet.", "description");
                    }
                } else {
                    this.output(`You examine the ${target}. Nothing special.`, "description");
                }
            }

            handleWork() {
                const loc = gameState.currentLocation;

                if (loc === 'gym') {
                    if (gameState.character.money < 20) {
                        this.output("You don't have enough money for a gym session ($20).", "error");
                        return;
                    }

                    this.modifyMoney(-20);
                    this.modifyEnergy(-30);
                    this.modifyHunger(20);
                    gameState.character.strength += 2;
                    this.advanceTime(60);

                    this.output("You hit the weights hard. Your muscles burn, but you feel stronger!", "success");
                    this.output("Strength +2, Energy -30, $20 spent", "system");
                } else if (loc === 'cafe') {
                    if (!gameState.flags.hasJob) {
                        this.output("You need to apply for a job first. Try 'apply for job'.", "error");
                        return;
                    }

                    this.modifyMoney(60);
                    this.modifyEnergy(-25);
                    this.modifyHunger(15);
                    gameState.character.businessSkill += 1;
                    this.advanceTime(240);

                    this.output("You work a 4-hour shift at the café, serving customers and managing the counter.", "success");
                    this.output("Earned $60, Business Skill +1", "system");
                } else {
                    this.output("There's nothing to work on here.", "error");
                }
            }

            handleSleep(hours) {
                if (gameState.currentLocation !== 'home') {
                    this.output("You need to go home to sleep properly.", "error");
                    return;
                }

                this.modifyEnergy(100);
                this.advanceTime(hours * 60);
                this.modifyHunger(30);

                this.output(`You sleep for ${hours} hours and wake up refreshed.`, "success");
                this.output("Energy restored to 100", "system");
            }

            handleEat(command) {
                if (gameState.currentLocation === 'home') {
                    if (gameState.character.money < 10) {
                        this.output("You don't have enough money for food ($10).", "error");
                        return;
                    }

                    this.modifyMoney(-10);
                    this.modifyHunger(-40);
                    this.advanceTime(30);

                    this.output("You prepare a simple meal at home. It's not gourmet, but it fills you up.", "success");
                    this.output("Hunger -40, $10 spent", "system");
                } else if (gameState.currentLocation === 'cafe') {
                    if (gameState.character.money < 15) {
                        this.output("You don't have enough money for café food ($15).", "error");
                        return;
                    }

                    this.modifyMoney(-15);
                    this.modifyHunger(-50);
                    this.advanceTime(20);

                    this.output("You order a sandwich and coffee. Delicious!", "success");
                    this.output("Hunger -50, $15 spent", "system");
                } else {
                    this.output("You can't eat here. Try going home or to a café.", "error");
                }
            }

            handleLoan(command) {
                if (gameState.currentLocation !== 'bank') {
                    this.output("You need to be at the bank to get a loan.", "error");
                    return;
                }

                const amount = command.amount || 10000;

                if (amount < 5000 || amount > 50000) {
                    this.output("Loans are available from $5,000 to $50,000.", "error");
                    return;
                }

                this.modifyMoney(amount);
                this.output(`Loan approved! You receive $${amount}.`, "success");
                this.output("Remember: This comes with 8% interest. Invest wisely!", "system");
                this.advanceTime(30);
            }

            handleApply() {
                if (gameState.currentLocation !== 'cafe') {
                    this.output("There are no job openings here.", "error");
                    return;
                }

                if (gameState.flags.hasJob) {
                    this.output("You already work here!", "error");
                    return;
                }

                gameState.flags.hasJob = true;
                this.output("The owner smiles and shakes your hand.", "success");
                this.output('"Welcome aboard! You can work shifts by typing \'work\'. We pay $60 per 4-hour shift."', "description");
                this.advanceTime(15);
            }

            handleBuy(command) {
                const target = command.target;

                if (target && target.includes('cafe')) {
                    if (gameState.character.money < 50000) {
                        this.output("You need $50,000 to buy the café. Keep working and saving!", "error");
                        return;
                    }

                    this.modifyMoney(-50000);
                    gameState.flags.ownsCafe = true;

                    this.output("═════════════════════════════════════", "event");
                    this.output("BUSINESS ACQUIRED!", "success");
                    this.output("You are now the proud owner of Coffee Bean Café!", "description");
                    this.output("The café will generate passive income of $200/day.", "description");
                    this.output("═════════════════════════════════════", "event");
                } else {
                    this.output(`You can't buy that right now.`, "error");
                }
            }

            showHelp() {
                this.output("═══════════════════════════════════════════════════", "system");
                this.output("AVAILABLE COMMANDS", "location");
                this.output("═══════════════════════════════════════════════════", "system");
                this.output("MOVEMENT:", "description");
                this.output("  • go to [location] - Travel somewhere", "system");
                this.output("  • look around - Describe current location", "system");
                this.output("");
                this.output("INTERACTION:", "description");
                this.output("  • talk to [person] - Speak with NPCs", "system");
                this.output("  • work - Do activities at current location", "system");
                this.output("  • apply for job - Get hired (at café)", "system");
                this.output("");
                this.output("BASIC NEEDS:", "description");
                this.output("  • sleep - Rest at home (restores energy)", "system");
                this.output("  • eat - Get food (reduces hunger)", "system");
                this.output("");
                this.output("BUSINESS:", "description");
                this.output("  • take loan - Get business loan at bank", "system");
                this.output("  • buy cafe - Purchase the café ($50,000)", "system");
                this.output("");
                this.output("INFO:", "description");
                this.output("  • stats - View full character stats", "system");
                this.output("  • check [thing] - Examine something", "system");
                this.output("  • inventory - View items", "system");
                this.output("  • save/load - Save or load game", "system");
            }

            showStats() {
                const c = gameState.character;
                this.output("═══════════════════════════════════════════════════", "system");
                this.output("CHARACTER STATS", "location");
                this.output("═══════════════════════════════════════════════════", "system");
                this.output(`Day ${c.day} - ${this.formatTime()}`, "description");
                this.output("");
                this.output("PHYSICAL:", "description");
                this.output(`  Health:      ${c.health}/100`, "system");
                this.output(`  Energy:      ${c.energy}/100`, "system");
                this.output(`  Hunger:      ${c.hunger}/100`, "system");
                this.output("");
                this.output("SKILLS:", "description");
                this.output(`  Intelligence:  ${c.intelligence}/100`, "system");
                this.output(`  Charisma:      ${c.charisma}/100`, "system");
                this.output(`  Strength:      ${c.strength}/100`, "system");
                this.output(`  Business:      ${c.businessSkill}/100`, "system");
                this.output("");
                this.output("FINANCIAL:", "description");
                this.output(`  Cash:        $${c.money}`, "system");
                this.output(`  Businesses:  ${gameState.flags.ownsCafe ? 'Coffee Bean Café' : 'None'}`, "system");
            }

            showInventory() {
                this.output("INVENTORY:", "description");
                gameState.inventory.forEach(item => {
                    this.output(`  • ${item}`, "system");
                });
            }

            checkRandomEvents() {
                if (Math.random() < 0.05 && gameState.character.day > 2) {
                    this.triggerRandomEvent();
                }
            }

            triggerRandomEvent() {
                const events = [
                    {
                        title: "LUCKY FIND",
                        text: "You find a $20 bill on the ground!",
                        effect: () => this.modifyMoney(20)
                    },
                    {
                        title: "HELPFUL STRANGER",
                        text: "A stranger gives you a productivity tip. You feel inspired!",
                        effect: () => gameState.character.intelligence += 1
                    }
                ];

                const event = events[Math.floor(Math.random() * events.length)];
                this.output("");
                this.output("═════════════════════════════════════", "event");
                this.output(event.title, "success");
                this.output(event.text, "description");
                this.output("═════════════════════════════════════", "event");
                event.effect();
            }

            saveGame() {
                const saveData = JSON.stringify(gameState);
                const blob = new Blob([saveData], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'lifeparser_save.json';
                a.click();
                this.output("Game saved! Download the file to load later.", "success");
            }

            loadGame() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                input.onchange = (e) => {
                    const file = e.target.files[0];
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        try {
                            const loaded = JSON.parse(event.target.result);
                            Object.assign(gameState, loaded);
                            this.updateUI();
                            this.output("Game loaded successfully!", "success");
                            this.describeLocation();
                        } catch (err) {
                            this.output("Failed to load save file.", "error");
                        }
                    };
                    reader.readAsText(file);
                };
                input.click();
            }

            // UTILITY METHODS
            advanceTime(minutes) {
                gameState.character.minute += minutes;
                
                while (gameState.character.minute >= 60) {
                    gameState.character.minute -= 60;
                    gameState.character.hour += 1;
                }

                while (gameState.character.hour >= 24) {
                    gameState.character.hour -= 24;
                    gameState.character.day += 1;
                    
                    if (gameState.flags.ownsCafe) {
                        this.modifyMoney(200);
                        this.output("Your café generated $200 in revenue today!", "success");
                    }
                }

                const hoursPassed = Math.floor(minutes / 60);
                this.modifyEnergy(-hoursPassed * 2);
                this.modifyHunger(hoursPassed * 3);
            }

            formatTime() {
                const hour = gameState.character.hour;
                const minute = gameState.character.minute;
                const period = hour >= 12 ? 'PM' : 'AM';
                const displayHour = hour % 12 || 12;
                return `${displayHour}:${minute.toString().padStart(2, '0')} ${period}`;
            }

            modifyMoney(amount) {
                gameState.character.money += amount;
                gameState.character.money = Math.max(0, gameState.character.money);
            }

            modifyEnergy(amount) {
                gameState.character.energy += amount;
                gameState.character.energy = Math.max(0, Math.min(100, gameState.character.energy));
            }

            modifyHunger(amount) {
                gameState.character.hunger += amount;
                gameState.character.hunger = Math.max(0, Math.min(100, gameState.character.hunger));
                
                if (gameState.character.hunger >= 80) {
                    this.modifyHealth(-5);
                }
            }

            modifyHealth(amount) {
                gameState.character.health += amount;
                gameState.character.health = Math.max(0, Math.min(100, gameState.character.health));
            }

            output(text, type = "description") {
                const div = document.createElement('div');
                div.className = `output-text ${type}`;
                div.textContent = text;
                this.outputElement.appendChild(div);
                this.outputElement.scrollTop = this.outputElement.scrollHeight;
            }

            updateUI() {
                const c = gameState.character;
                document.getElementById('day').textContent = c.day;
                document.getElementById('time').textContent = this.formatTime();
                document.getElementById('money').textContent = `$${c.money}`;
                
                const healthEl = document.getElementById('health');
                healthEl.textContent = c.health;
                healthEl.className = 'stat-value';
                if (c.health < 30) healthEl.classList.add('error');
                else if (c.health < 60) healthEl.classList.add('warning');
                
                const energyEl = document.getElementById('energy');
                energyEl.textContent = c.energy;
                energyEl.className = 'stat-value';
                if (c.energy < 30) energyEl.classList.add('error');
                else if (c.energy < 60) energyEl.classList.add('warning');
                
                const hungerEl = document.getElementById('hunger');
                hungerEl.textContent = c.hunger;
                hungerEl.className = 'stat-value';
                if (c.hunger > 70) hungerEl.classList.add('error');
                else if (c.hunger > 50) hungerEl.classList.add('warning');
            }
        }

        // ============================================
        // INITIALIZE GAME
        // ============================================
        const game = new GameEngine();
        
        window.addEventListener('DOMContentLoaded', () => {
            game.init();

            const input = document.getElementById('command-input');
            const submitBtn = document.getElementById('submit-btn');

            submitBtn.addEventListener('click', () => {
                const command = input.value;
                if (command) {
                    game.processCommand(command);
                    input.value = '';
                }
            });

            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    submitBtn.click();
                }
            });

            input.focus();
        });
    </script>
</body>
</html>
